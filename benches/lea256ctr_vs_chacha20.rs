// Copyright Â© 2020 SitD <sitd0813@gmail.com>
//
// This file is subject to the terms of the MIT License.
// If a copy of the MIT License was not distributed with this file, you can obtain one at https://opensource.org/licenses/MIT.

use criterion::{Criterion, black_box, criterion_group, criterion_main};

use chacha20::ChaCha20;
use lea::ctr::{
	stream::{generic_array::arr, NewStreamCipher, SyncStreamCipher},
	Lea256Ctr
};

fn criterion_benches(c: &mut Criterion) {
	let key256 = arr![u8; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F, 0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F];

	let mut data = [
		0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F,
		0x10, 0x11, 0x12, 0x13, 0x14, 0x15, 0x16, 0x17, 0x18, 0x19, 0x1A, 0x1B, 0x1C, 0x1D, 0x1E, 0x1F,
		0x20, 0x21, 0x22, 0x23, 0x24, 0x25, 0x26, 0x27, 0x28, 0219, 0x2A, 0x2B, 0x2C, 0x2D, 0x2E, 0x2F,
		0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x3A, 0x3B, 0x3C, 0x3D, 0x3E, 0x3F
	];

	let nonce96 = arr![u8; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B];
	let mut chacha20 = ChaCha20::new(&key256, &nonce96);

	c.bench_function("[lea256ctr_vs_chacha20] ChaCha20::new", |b| { b.iter(|| {
		black_box(ChaCha20::new(&key256, &nonce96));
	}) });
	c.bench_function("[lea256ctr_vs_chacha20] ChaCha20::apply_keystream", |b| { b.iter(|| {
		chacha20.apply_keystream(&mut data);
	}) });

	let nonce128 = arr![u8; 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x1F];
	let mut lea256ctr = Lea256Ctr::new(&key256, &nonce128);

	c.bench_function("[lea256ctr_vs_chacha20] Lea256Ctr::new", |b| { b.iter(|| {
		black_box(Lea256Ctr::new(&key256, &nonce128));
	}) });
	c.bench_function("[lea256ctr_vs_chacha20] Lea256Ctr::apply_keystream", |b| { b.iter(|| {
		lea256ctr.apply_keystream(&mut data);
	}) });

	black_box(data);
}

criterion_group!(benches, criterion_benches);
criterion_main!(benches);